---
title: "DS 202 Final Project"
author: "Kellan Bouwman, Adam Ford, Heather Moore, Brett White, Ashley Sackpraseuth, Felix Baez"
output: html_document
---

Introduction & Cleaning
*Brett White*
    
     
```{r}
# tidyverse
library(tidyverse)
# readxl
library(readxl)
df1 <- read.csv('table01.csv')
df2 <- read.csv('table02a.csv')
df3 <- read.csv('table02b.csv')
df4 <- read.csv('table02c.csv')
df5 <- read.csv('table02d.csv')
# head(df1)
# head(df2)
# head(df3)
# head(df4)
# head(df5)
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
library(lubridate)
```

## Import and Rename Columns
```{r}
table01 <- read.csv("table01.csv")
table01 <- table01 %>%
  rename(
    stateAbb = State.abbreviation,
    stateName = State.name,
    congressDist = Congressional.district,
    votesCastForCongress = Votes.cast.for.congressional.representative.for.the.November.6..2018.election,
    votingAgePopulation = Citizen.voting.age.population.estimate,
    votingAgePopulationMOE = Citizen.voting.age.population.Margin.of.Error,
    votingRate = Voting.rate.estimate,
    votingRateMOE = Voting.rate.Margin.of.Error
  )
head(table01, 5)
table02a <- read.csv("table02a.csv")
table02a <- table02a %>%
  rename(
    stateAbb = State.abbreviation,
    stateName = State.name,
    congressDist = Congressional.district,
    votingAgePopulation = Citizen.voting.age.population.estimate,
    votingAgePopulationMOE = Citizen.voting.age.population.MOE
  )
table02b <- read.csv("table02b.csv")
table02b <- table02b %>%
  rename(
    stateAbb = State.abbreviation,
    stateName = State.name,
    congressDist = Congressional.district,
    votingAgePopulation = Citizen.voting.age.population.estimate,
    votingAgePopulationMOE = Citizen.voting.age.population.MOE
  )
```


Education Analysis
*Kellan Bouwman*

```{r}
# head(df4)
eduPol <- df4 %>% select(State.abbreviation, State.name, Congressional.district, Citizen.voting.age.population.estimate, Less.grade.9.estimate, Grade.9.12.no.diploma.estimate, High.school.graduate.estimate, Some.college.no.degree.estimate, Associate.degree.estimate, Bachelor.degree.estimate, Graduate.degree.estimate, High.school.or.more.estimate, Bachelor.degree.or.more.estimate)
eduPol %>% full_join(df1) -> eduPol

eduPol %>% pivot_longer(Less.grade.9.estimate:Bachelor.degree.or.more.estimate, names_to = "Education", values_to = "Amount") -> eduPol
#head(eduPol)
#add gender break down
df3 %>% 
  select(State.abbreviation, State.name, Congressional.district, Citizen.voting.age.population.estimate, Men.estimate, Women.estimate, Men.percent.total, Women.percent.total) -> gender

gender %>%
  pivot_longer(Men.estimate:Women.estimate, names_to = "Gender", values_to = "Percentage") %>%
  pivot_longer(Men.percent.total:Women.percent.total, names_to = "GenderTotal", values_to = "PercentageTotal")-> gender

eduPol %>%
  full_join(gender) -> eduPol
#head(eduPol)

eduPol %>%
  mutate(PercentageEdu = (Amount / Citizen.voting.age.population.estimate) * 100 ) -> eduPol

eduPol %>%
  group_by(Education) %>%
  summarise(mean = mean(PercentageEdu, na.rm=TRUE), n = n())

ggplot(eduPol, aes(x=PercentageEdu, y=Voting.rate.estimate)) + geom_point() + geom_smooth(method='lm') + facet_wrap(~Education, scales = "free")

#head(eduPol)
```

Age Analysis
*Adam Ford*

```{r}
table02a <- table01 %>%
  select(stateAbb, congressDist, votingRate) %>%
  inner_join(table02a, by = c('stateAbb', 'congressDist'))
mean18.29 <- mean(table02a$Ages.18.29.percent.estimate)
mean30.44 <- mean(table02a$Ages.30.44.percent.estimate)
mean45.64 <- mean(table02a$Ages.45.64.percent.estimate)
mean65.up <- mean(table02a$Ages.65.up.percent.estimate)
# mean18.29
# mean30.44
# mean45.64
# mean65.up
table02a$dif18.29 <- mean18.29 - table02a$Ages.18.29.percent.estimate
table02a$dif30.44 <- mean30.44 - table02a$Ages.30.44.percent.estimate
table02a$dif45.64 <- mean45.64 - table02a$Ages.45.64.percent.estimate
table02a$dif65.up <- mean65.up - table02a$Ages.65.up.percent.estimate
```

### 18 - 29
```{r}
table02a %>% 
  select(stateName, congressDist, dif18.29, votingRate) %>%
  arrange(desc(dif18.29)) %>%
  head(5)
```

### 30 - 44
```{r}
table02a %>%
  select(stateName, congressDist, dif30.44, votingRate) %>%
  arrange(desc(dif30.44)) %>%
  head(5)
```

### 45 - 64
```{r}
table02a %>%
  select(stateName, congressDist, dif45.64, votingRate) %>%
  arrange(desc(dif45.64)) %>%
  head(5)
```

### 65 and up
```{r}
table02a %>%
  select(stateName, congressDist, dif65.up, votingRate) %>%
  arrange(desc(dif65.up)) %>%
  head(5)
```

  These tables show the congressional districts that have the nationwide greatest percentage of voters in the stated age groups. A notable state on these lists is Florida, it dominates the maximums for young voters. A pattern is beginning to show in the Voting Rates as well. We see that the states with high populations of young voters also have a High Voting Rate.
```{r}
ggplot(table02a, aes(x=dif18.29, y=votingRate)) +geom_point() + geom_smooth(method='lm') + xlab("Difference in Percent Composition of Voters Ages 18-29 compared to the National Average") + ylab("Voting Rate")+ ggtitle("Difference in the 18-29 age group versus Voting Rate in Congressional Districts")

ggplot(table02a, aes(x=dif45.64, y=votingRate)) +geom_point() + geom_smooth(method='lm')  + xlab("Difference in Percent Composition of Voters Ages 45-64 compared to the National Average") + ylab("Voting Rate")+ ggtitle("Difference in the 45-64 age group versus Voting Rate in Congressional Districts")
```

  These two graphs show two starkly different relationships between Difference of Composition of Voters Ages 18-29 and 45-64 to the National Averages versus the respective Voting Rates. In more laymans terms, congressional districts thats has a higher percentage of voters 18 - 29 than the nation, tend to have better voter turnouts. The opposite can be said about the age group of 45 - 64. 
  
Geographic Analysis
*Felix Baez*

```{r}

```

Race Analysis
*Ashley Sackpraseuth*

```{r}
race <- df5 %>%
  inner_join(df1, by = c("State.name", "Congressional.district", "Citizen.voting.age.population.estimate"))

race <- df5 %>% 
  select(State.abbreviation, State.name, Congressional.district, White.percent.total, Black.percent.total, Hispanic.percent.total,  Asian.percent.total, Two.or.more.percent.total)

race %>% full_join(df1) -> race

race[is.na(race)] <- 0 

race <- race %>%
  rename(White.voting.rate = White.percent.total, Black.voting.rate = Black.percent.total, Hispanic.voting.rate = Hispanic.percent.total, Asian.voting.rate = Asian.percent.total, Two.or.more.voting.rate = Two.or.more.percent.total)

race_scatterplot <- race %>% pivot_longer(White.voting.rate:Two.or.more.voting.rate, names_to = "Race.ethnicity", values_to = "Percent") 

race_scatterplot$Race.ethnicity <- factor(race_scatterplot$Race.ethnicity, levels=c("White.voting.rate", "Black.voting.rate", "Hispanic.voting.rate", "Asian.voting.rate", "Two.or.more.voting.rate"))

race_scatterplot %>%
  group_by(Race.ethnicity) %>%
  summarise(mean = mean(Percent))


ggplot(race_scatterplot, aes(x=Voting.rate.estimate, y=Percent)) + geom_point() + geom_smooth(method='lm') + facet_wrap(~Race.ethnicity, scales = "free_y") + xlim(27, 72) + ggtitle("Race/Ethnicity Voting Rates vs. Total Congressional District Voting Rate") + xlab("Total Congressional District Voting Rate") + ylab("Race/Ethnicity Voting Rate")
```


Race Voting Maps
*Ashley Sackpraseuth*

```{r}
library(sf)

map_base <- race %>%
  mutate(
    Congressional.district=ifelse(Congressional.district=='At-large',0,Congressional.district),
    Congressional.district = as.numeric(Congressional.district))

map_data <- st_read('districts114.shp') %>%
  mutate(
    STATENAME = as.character(STATENAME), 
    STATENAME=ifelse(STATENAME=='District Of Columbia','District of Columbia',STATENAME),
    DISTRICT=ifelse(STATENAME=='District of Columbia',0,DISTRICT)
  ) %>%
  select(STATENAME, DISTRICT, geometry)


voting.rate_map <- map_base %>%
  inner_join(map_data %>% 
               filter(!(STATENAME == 'Alaska' | STATENAME == 'Hawaii')) %>% 
               mutate(DISTRICT = DISTRICT - 1), by=c('State.name'='STATENAME','Congressional.district'='DISTRICT'))


voting.rate_map[is.na(voting.rate_map)] <- 0

race %>%
  summarise(mean = mean(Voting.rate.estimate))

voting.rate_map %>% 
  ggplot(aes(fill=Voting.rate.estimate,geometry=geometry)) + geom_sf() + theme_void() + scale_fill_gradient2(midpoint = 48.60069) + ggtitle("Total Voting Rate by Congressional District")


# Map of Voting Rate Race Breakdown

#install.packages(gridExtra)
library(gridExtra)

white_map <- voting.rate_map %>% 
  ggplot(aes(fill=White.voting.rate, geometry=geometry)) + geom_sf() + theme_void() + scale_fill_distiller(palette='Blues', direction = 1) + ggtitle("White Voting Rate")

black_map <- voting.rate_map %>% 
  ggplot(aes(fill=Black.voting.rate,geometry=geometry)) + geom_sf() + theme_void() + scale_fill_distiller(palette='Purples', direction = 1)+ ggtitle("Black Voting Rate")

hispanic_map <- voting.rate_map %>% 
  ggplot(aes(fill=Hispanic.voting.rate,geometry=geometry)) + geom_sf() + theme_void() + scale_fill_distiller(palette='Greens', direction = 1) + ggtitle("Hispanic Voting Rate")

asian_map <- voting.rate_map %>% 
  ggplot(aes(fill=Asian.voting.rate,geometry=geometry)) + geom_sf() + theme_void() + scale_fill_distiller(palette='Reds', direction = 1) + ggtitle("Asian Voting Rate")

two.or.more_map <- voting.rate_map %>% 
  ggplot(aes(fill=Two.or.more.voting.rate,geometry=geometry)) + geom_sf() + theme_void() + scale_fill_distiller(palette='YlGnBu', direction = 1 ) + ggtitle("Two or More Races Voting Rate")

grid.arrange(white_map, black_map, hispanic_map, asian_map, two.or.more_map)
```

Poverty Analysis
*Heather Moore*

```{r}
library(maps)
library(dplyr)
library(ggplot2)

Pov <- read.csv("table02b.csv")
Pov2 <- Pov %>% select(State.name,Congressional.district,Poverty.universe, Below.poverty.level.estimate, Below.poverty.level.percent.total, Citizen.voting.age.population.estimate)

names(Pov2)[names(Pov2) == "State.name"] <- "region"

Pov2$region <- tolower(Pov2$region)

Per_Coun <- Pov2 %>% select(region, Congressional.district, Below.poverty.level.percent.total) %>% filter(Below.poverty.level.percent.total > 20) %>% arrange(desc(Below.poverty.level.percent.total))
Per_Coun
```

The table above displays the congressional districts that have the highest percentage of voters under the poverty line. It appears the New York's 15th Congressional district has the most below poverty line voters at 30%. Following behind is Michigan's 13th and Kentucky's 5th districts at 24%. It's important to note that out of the top ten, four of the states are in the southern part of the United States. Also, both New York and Pennsylvania have 2 districts that fall under this classification.

```{r}
#Bar Chart 
BelPov <- Pov2 %>% group_by(region) %>% summarize(Pov_Uni = sum(Poverty.universe), Below_Pov = sum(Below.poverty.level.estimate)) 

BelPov$Percent_Below_Pov <- (BelPov$Below_Pov/BelPov$Pov_Uni) *100
BelPov2 <- BelPov %>% subset(Percent_Below_Pov > 14.6)

BelPov2 %>% ggplot(aes(region, Percent_Below_Pov)) + geom_bar(stat = 'identity', fill = 'blue') + labs(x = 'States', y = 'Percentage', title = 'Percentage of Voters Below the Poverty Line')  

```

After completing some analysis on the individual congressional districts, it will be meaningful to see if the same results would stand when looking at the states as a whole. The bar graph displays the states with the largest percentage of voters below the poverty line. In contrast from the table above, Mississippi has the the most below poverty line voters at almost 17% of voters participation falling into that category. An important pattern that is developing is that southern states tend to have the most voters that fall below the poverty line. 
```{r}
#map
library(RColorBrewer)

names(Pov2)[names(Pov2) == 'State.name'] <- 'region' 
State <- map_data('state')

map <- left_join(State, BelPov, by = 'region')
map %>% ggplot(aes(long, lat)) + geom_polygon(aes(group=group, fill = Percent_Below_Pov)) + scale_fill_distiller(palette = 'Blues') + theme_void() + labs(title = 'Percentage of Below the Poverty Line Voters by State') 
```

The final part of this analysis shows the correlation of below poverty line voters and the states. In this map,  the south holds the largest group of below poverty line voters. Which continues to proves the pattern that the south has most of the voters in that category.

Conclusion






